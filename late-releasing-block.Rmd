---
output:
  html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```
<style type="text/css">
div.main-container {
  max-width: 2000px;
  margin-left: 0;
  margin-right: auto;
}
</style>
<style>
.tocify {
color: black;
}
<!-- } -->
<!-- .tocify .tocify-header { -->
<!--     position: fixed; -->
<!--     <!-- top: 50px; --> -->
<!--     left: 50px; -->
<!--     width: 350px; -->
<!--     <!-- border: solid 3px black; --> -->
<!--     <!-- height: 200px; --> -->
<!--  border: none; -->
<!-- } -->
.tocify .tocify-header .active {
color: white;
background: #d80b8c;
font-weight: bold;
}
<!-- .tocify .tocify-item { -->
<!-- background: white; -->
<!-- color: black; -->
<!--  border: none; -->
<!-- } -->
</style>
<style>
  .nav-pills>li>a:hover, .nav-pills>li>a:focus, .nav-pills>li.active>a,     .nav-pills>li.active>a:hover, .nav-pills>li.active>a:focus{
     background-color: #212070;
     }
</style>
<style>
.container { width: 1800px; }
h2 {
  background-color: #dddedd;
  color: black;
  text-indent: 20px;
  <!-- font-weight: bold; -->
}
h3 {
  background-color: #f2f2f2;
  color: black;
  text-indent: 20px;
  <!-- font-weight: bold; -->
}
h4 {
  <!-- background-color: #dddedd; -->
  <!-- color: black; -->
  text-indent: 50px;
  <!-- font-weight: bold; -->
}
</style>
<style>
.blackbox {
  padding: 1em;
  background: white;
  color: black;
  border: 2px solid #7f7f7f;
  width: 100%;
  position: center;
  align: center;
  margin: 0px auto;
}
.center {
  text-align: left;
  margin: 0px auto;
}
</style>
<!-- ```{css toc-content, echo = FALSE} -->
<!-- #TOC { -->
<!--   right: 270px; -->
<!--   margin: 20px 0px 25px 0px; -->
<!-- } -->
<!-- .main-container { -->
<!--     margin-left: 200px; -->
<!-- } -->
<!-- ``` -->
```{r Load Packages, echo = FALSE, warning = FALSE, message = FALSE}
# # Load packages -----------------------------------------------------------------------------------
suppressMessages({
  memory.limit(size = 8000000)
  library(readxl)
  library(writexl)
  library(plyr)
  library(dplyr)
  library(data.table)
  library(zoo)
  library(shiny)
  library(shinydashboard)
  library(shinydashboardPlus)
  library(shinyWidgets)
  library(htmlwidgets)
  library(lubridate)
  library(tcltk)
  library(tidyverse)
  library(plotly)
  library(knitr)
  library(kableExtra)
  library(leaflet)
  library(grid)
  library(gridExtra)
  library(eeptools)
  library(ggQC)
  library(zipcodeR)
  library(utils)
  library(scales)
  library(chron)
  library(bupaR)
  library(shiny)
  library(DT)
  library(DiagrammeR)
  library(shinyalert)
  library(edeaR)
  library(processmapR)
  library(processmonitR)
  library(processanimateR)
  library(tidyr)
  library(lubridate)
  library(RColorBrewer)
  library(DiagrammeR)
  library(ggplot2)
  library(leaflet)
  library(readr)
  library(highcharter)
  library(ggforce) # for 'geom_arc_bar'
  library(packcircles) # for packed circle graph
  library(viridis)
  library(ggiraph)
  library(treemapify)
  library(treemap)
  library(broom)
  library(extrafont)
  library(tis) # for US holidays
  library(vroom)
  library(sjmisc)
  library(tools)
  library(here)
  library(shinyBS)
  library(shinyscreenshot)
  library(fasttime)
  library(shinycssloaders)
  library(feather)
  # library(zipcodeR)
  library(formattable)
  library(shinyjs)
  library(janitor)
  library(patchwork)
  library(flexdashboard)
  # library(tidyverse)
  # library(viridis)
  # library(hrbrthemes)
  # library(plotly)
  # install.packages("bsts")
  library(bsts)
  library(reactable)
  # install.packages("reactablefmtr")
  library(reactablefmtr)
  library(svDialogs)
  # library(openxlsx)
  library(flextable)
  library(officedown)
  library(officer)
  library(magrittr)
  library(webshot) 
  library(png)
  library(ggh4x)
  library(RODBC)
  library(DBI)
  library(odbc)
  library(dbplyr)
  library(pool)
  library(emojifont)
})
```


```{r Graph asthetics, echo = FALSE, warning = FALSE, message = FALSE}
### Color Functions for Graphs ============================================================
# Mount Sinai corporate colors "USE THIS TO ADD COLORS"
MountSinai_colors <- c(
  `dark purple`  = "#212070",
  `dark pink`    = "#d80b8c",
  `dark blue`    = "#00aeef",
  `dark grey`    = "#7f7f7f",
  `yellow`       = "#ffc000",
  `purple`       = "#7030a0",
  `med purple`   = "#5753d0",
  `med pink`     = "#f75dbe",
  `med blue`     = "#5cd3ff",
  `med grey`     = "#a5a7a5",
  `light purple` = "#c7c6ef",
  `light pink`   = "#fcc9e9",
  `light blue`   = "#c9f0ff",
  `light grey`   = "#dddedd"
  )
# Function to extract Mount Sinai colors as hex codes
# Use Character names of MountSinai_colors
MountSinai_cols <- function(...) {
  cols <- c(...)
  
  if (is.null(cols))
    return (MountSinai_colors)
  
  MountSinai_colors[cols]
}
# Color Function that can be used to call all colors is "MountSinai_cols()"
# Use in ggplot 
  #MountSinai_cols()       # will provide all colors and their hex codes in a table 
  #MountSinai_cols("pink") # will provide color name and the hex code for the pink color
# Create palettes 
MountSinai_palettes <- list(
  `all`   = MountSinai_cols("dark purple","dark pink","dark blue","dark grey",
                            "med purple","med pink","med blue","med grey", 
                            "light purple","light pink","light blue","light grey"),
  
  `main`  = MountSinai_cols("dark purple","dark pink","dark blue","dark grey"),
  
  `purple`  = MountSinai_cols("dark purple","med purple","light purple"),
  
  `pink`  = MountSinai_cols("dark pink","med pink","light pink"),
  
  `blue`  = MountSinai_cols("dark blue", "med blue", "light blue"),
  
  `grey`  = MountSinai_cols("dark grey", "med grey", "light grey"),
  
  `purpleGrey` = MountSinai_cols("dark purple", "dark grey"),
  
  `pinkBlue` = MountSinai_cols("dark pink", "dark blue")
  
)
# MountSinai_palettes
# Return function to interpolate a Mount Sinai color palette
# default value is the main palette, reverse = True will change the order
MountSinai_pal <- function(palette = "all", reverse = FALSE, ...) {
  pal <- MountSinai_palettes[[palette]]
  
  if (reverse) pal <- rev(pal)
  
  colorRampPalette(pal, ...)
}
# Scale Function for ggplot can be used instead of scale_color_manual
scale_color_MountSinai <- function(palette = "all", discrete = TRUE, reverse = FALSE, ...) {
  pal <- MountSinai_pal(palette = palette, reverse = reverse)
  
  if (discrete) {
    discrete_scale("colour", paste0("MountSinai_", palette), palette = pal, ...)
  } else {
    scale_color_gradientn(colours = pal(256), ...)
  }
}
# Scale Fill for ggplot insetead of scale_fill_manual 
scale_fill_MountSinai <- function(palette = "all", discrete = TRUE, reverse = FALSE, ...) {
  pal <- MountSinai_pal(palette = palette, reverse = reverse)
  if (discrete) {
    discrete_scale("fill", paste0("MountSinai_", palette), palette = pal, ...)
  } else {
    scale_fill_gradientn(colours = pal(256), ...)
  }
}
# Use in ggplot 
  # scale_color_MountSinai("main")
```


```{r Global Variables, echo = FALSE, warning = FALSE, message = FALSE}
'%!in%' <- function(x,y)!('%in%'(x,y))
```


```{r Connect to Tables, echo = FALSE, warning = FALSE, message = FALSE}
# Connection to Oracle DB ------------------------------------------------------
conn1 <- dbPool(drv = odbc(), dsn = "OAO Cloud DB SoYoun", timeout = 30)
conn2 <- dbConnect(odbc(), 
                  "Clarity_prod", 
                  uid = "kweons01" , 
                  pwd = "kweons01123$")
# Import Slot Availability Data ------------------------------------------------
slot_raw_tbl <- tbl(conn2, "Y_DM_BOOKED_FILLED_RATE")
access_raw_tbl <- tbl(conn2, "MV_DM_PATIENT_ACCESS")
availability_raw_tbl <- tbl(conn2, "V_AVAILABILITY")
block_raw_tbl <- tbl(conn2, "AVAIL_BLOCK")
block_name_tbl <- tbl(conn2, "ZC_APPT_BLOCK")
orders_raw_tbl <- tbl(conn2, "ORDER_PROC")
coverage_tbl <- tbl(conn2, "V_PAT_ENC_COVERAGE")
template_tbl <- tbl(conn2, "TEMPLATE")
```


```{r Report Variables, echo = FALSE, warning = FALSE, message = FALSE}
report_run_date <- Sys.Date()
```


```{r Department and Provider Mapping, echo = FALSE, warning = FALSE, message = FALSE}
# Department and Provider Mapping ----------------------------------------------
dept_mapping <- access_raw_tbl %>%
  group_by(SITE, DEPARTMENT_ID, DEPARTMENT_NAME, DEPT_SPECIALTY_NAME) %>%
  summarise(total = n()) %>%
  collect() %>%
  dplyr::select(-total)
prov_mapping <- access_raw_tbl %>%
  group_by(PROV_ID, PROV_NAME_WID) %>%
  summarise(total = n()) %>%
  collect() %>%
  dplyr::select(-total)
prov_mapping$PROV_NAME <- trimws(gsub("\\[.*?\\]", "", prov_mapping$PROV_NAME_WID))
```


```{r New Patient Blocks, echo = FALSE, warning = FALSE, message = FALSE}
new_blocks <- c(
  "GMA New Pt",
  "Endo New Patient",
  "Covid New Patient",
  "Concussion New",
  "GYN NEW PT",
  "Hematology New Patient",
  "Initial Eval/New",
  "Lymphedema New",
  "Medicare Wellness - New",
  "New Cancer Patient",
  "NEW EAR",
  "New Lar",
  "New Patient Continued",
  "New Patient Extended",
  "New Patient freeze",
  "New Patient Only",
  "New Patient pt",
  "New Patient Start",
  "NEW PATIENT-GERIATRICS",
  "NEW RUNNING EVAL",
  "New Vertigo Patient",
  "NEW VOICE MODIFICATION",
  "New/Follow-up",
  "New/Fup/Hyl",
  # "OB NEW PATIENT",
  "Onc PT New",
  "Oncology New Patient",
  "OPR Sports New",
  "PA GYN NEW",
  "PALL-NEW PT",
  "PEDS CONCUSSION NEW",
  "PEDS NEW",
  "PEDS ORTHO NEW",
  "Physical Exam - New",
  "SINUS NEW",
  "Sports New",
  "VESTIBULAR NEW",
  "Zocdoc New",
  "New Patient 14-Day",
  "New Patient 21-Day",
  "New Patient 28-Day",
  "New Patient 7-Day",
  "ALS NEW",
  "APOS NEW",
  "Autoimmune New",
  "CF NEW",
  "COVID-19 SCREENING IN OFFICE NEW PATIENT",
  "Initial Visit",
  "New Pt - Straight Medicare",
  "NEW SELIKOFF",
  "OPR New Patient",
  "WOMEN'S SPORTS PT NEW",
  "New Patient pt",
  "Pregnancy Confirmation",
  "New Patient Start",
  "NEW GYN 7-DAY",
  "NEW GYN 14-DAY",
  "NEW GYN 21-DAY",
  "NEW GYN 28-DAY"
)
release_blocks <- c(
  "New Patient 14-Day",
  "New Patient 21-Day",
  "New Patient 28-Day",
  "New Patient 7-Day",
  "NEW GYN 7-DAY",
  "NEW GYN 14-DAY",
  "NEW GYN 21-DAY",
  "NEW GYN 28-DAY"
)
```


```{r Late Releasing Slots, echo = FALSE, warning = FALSE, message = FALSE}
# Slot Block Data --------------------------------------------------------------
late_block_raw <- block_raw_tbl %>%
  mutate(Slot.DateYear = TO_DATE(SLOT_BEGIN_TIME),
         Slot.Year = year(SLOT_BEGIN_TIME),
         Slot.Month = month(SLOT_BEGIN_TIME)) %>%
    # filter(Slot.DateYear >= as.Date("2023-10-01")) %>%
  filter(Slot.DateYear >= as.Date("2023-11-01")) %>%
  # filter(Slot.Year == 2024) %>%
  # filter(Slot.Month >= 08) %>%
  left_join(block_name_tbl %>% dplyr::select(APPT_BLOCK_C, NAME), 
            by = c("BLOCK_C" = "APPT_BLOCK_C")) %>%
  left_join(block_name_tbl %>% dplyr::select(APPT_BLOCK_C, NAME), 
            by = c("REL_BLOCK_C" = "APPT_BLOCK_C")) %>%
  rename(block_name = NAME.x,
         org_block_name = NAME.y) %>%
  mutate(comb_block_name = trim(ifelse(is.na(org_block_name), block_name, org_block_name))) %>%
  left_join(availability_raw_tbl %>% dplyr::select(PROV_ID, DEPARTMENT_ID, SLOT_BEGIN_TIME, ORG_REG_OPENINGS) %>%
              group_by(PROV_ID, DEPARTMENT_ID, SLOT_BEGIN_TIME, ORG_REG_OPENINGS) %>%
              summarise(total = n()) %>%
              dplyr::select(-total),
            by = c("PROV_ID", "DEPARTMENT_ID", "SLOT_BEGIN_TIME")) 

```


```{r Block Usage Audit, echo = FALSE, warning = FALSE, message = FALSE}
# # Block combinations by time slot ----------------------------------------------
# ## Shows all blocks associated to each time slot -------------------------------
# blocks_combined <- late_block_raw %>%
#   collect()
#   ungroup() %>%
#   arrange(DEPARTMENT_ID, SLOT_BEGIN_TIME, comb_block_name) %>%
#   group_by(DEPARTMENT_ID, PROV_ID, SLOT_BEGIN_TIME, Slot.DateYear, comb_block_name) %>%
#   summarise(total_blocks = n())
# ## Count of Block Combination Usage --------------------------------------------
# block_combination_usage <- blocks_combined %>%
#   collect() %>%
#   group_by(DEPARTMENT_ID, PROV_ID, SLOT_BEGIN_TIME) %>%
#   mutate(block_combination = paste0(unique(comb_block_name), collapse = ', ')) %>%
#   mutate(total_blocks = length(unique(comb_block_name))) %>%
#   group_by(DEPARTMENT_ID, PROV_ID, Slot.DateYear, block_combination, total_blocks) %>%
#   summarise(total_slots = length(unique(SLOT_BEGIN_TIME))) %>%
#   mutate(slot_incorrect = case_when(total_blocks >1 & str_detect(block_combination, str_c(release_blocks, collapse = "|")) ~ "Yes",
#                                     TRUE ~ "No"))
#   
#   
# block_combination_usage$Site <- dept_mapping$SITE[match(block_combination_usage$DEPARTMENT_ID, dept_mapping$DEPARTMENT_ID)]
# block_combination_usage$Department <- dept_mapping$DEPARTMENT_NAME[match(block_combination_usage$DEPARTMENT_ID, dept_mapping$DEPARTMENT_ID)]
# block_combination_usage$Provider <- prov_mapping$PROV_NAME[match(block_combination_usage$PROV_ID, prov_mapping$PROV_ID)]
```


```{r Block Combination and Openings, echo=FALSE, message=FALSE, warning=FALSE}
# Block combinations by time slot ----------------------------------------------
## Shows all blocks associated to each time slot -------------------------------
blocks_combined <- late_block_raw %>%
  ungroup() %>%
  arrange(DEPARTMENT_ID, SLOT_BEGIN_TIME, comb_block_name) %>%
  group_by(DEPARTMENT_ID, PROV_ID, SLOT_BEGIN_TIME, Slot.DateYear, LINE, comb_block_name, ORG_AVAIL_BLOCKS, ORG_REG_OPENINGS) %>%
  summarise(total_blocks = n())
  # filter(PROV_ID == "240337") %>%
  # filter(DEPARTMENT_ID == 8827017) %>%
  


block_openings <- blocks_combined %>%
  mutate(block_type = case_when(comb_block_name %in% release_blocks ~ "release",
                                comb_block_name %in% new_blocks ~ "new",
                                TRUE ~ "non-new")) %>%
  collect() %>%
  group_by(DEPARTMENT_ID, PROV_ID, SLOT_BEGIN_TIME) %>%
  mutate(block_combination = paste0(unique(comb_block_name), collapse = ', ')) %>%
  group_by(DEPARTMENT_ID, PROV_ID, SLOT_BEGIN_TIME, Slot.DateYear, ORG_REG_OPENINGS, block_combination, block_type) %>%
  summarise(openings = sum(ORG_AVAIL_BLOCKS),
            blocks = n()) %>%
  pivot_wider(names_from = block_type,
              values_from = openings:blocks) %>%
  mutate(total_slot = 1,
         incorrect_slot_reason = case_when(blocks_release >= 1 & `blocks_non-new` >= 1 & ORG_REG_OPENINGS - `openings_non-new` < 1 ~ "Late-Releasing Combination with No Openings",
                                           `blocks_non-new` >= 1 & blocks_new >= 1 & ORG_REG_OPENINGS - `openings_non-new` < 1 ~ "New Combination with No Openings",
                                           TRUE ~ "")) %>%
  mutate(incorrect_slot = ifelse(incorrect_slot_reason == "", 0, 1)) %>%
  filter(incorrect_slot == 1)

block_openings <- block_openings %>%
  mutate(Slot.YearMonth = format(as.Date(SLOT_BEGIN_TIME),"%Y-%m"))

block_openings <- block_openings %>%
  mutate(incorrect_perc = round(incorrect_slot/total_slot,2))

block_openings$openings_new[is.na(block_openings$openings_new)] <- 0
block_openings$`openings_non-new`[is.na(block_openings$`openings_non-new`)] <- 0
block_openings$openings_release[is.na(block_openings$openings_release)] <- 0


block_openings$Site <- dept_mapping$SITE[match(block_openings$DEPARTMENT_ID, dept_mapping$DEPARTMENT_ID)]
block_openings$Specialty <- dept_mapping$DEPT_SPECIALTY_NAME[match(block_openings$DEPARTMENT_ID, dept_mapping$DEPARTMENT_ID)]
block_openings$Department <- dept_mapping$DEPARTMENT_NAME[match(block_openings$DEPARTMENT_ID, dept_mapping$DEPARTMENT_ID)]
block_openings$Provider <- prov_mapping$PROV_NAME[match(block_openings$PROV_ID, prov_mapping$PROV_ID)]
```


```{r Time Release Block Conversion, echo = FALSE, warning = FALSE, message = FALSE}
# Categorize slots by non-new vs. new vs. new time-relese 
blocks_combined_type <- blocks_combined %>%
  mutate(new_block = case_when(comb_block_name %in% new_blocks ~ "NEW_BLOCK",
                               TRUE ~ "NON_NEW_BLOCK"),
         release_block = case_when(comb_block_name %in% release_blocks ~ "TIME_RELEASE",
                                   TRUE ~ "NON_TIME_RELEASE")) %>%
  collect() %>%
  arrange(DEPARTMENT_ID, PROV_ID, SLOT_BEGIN_TIME, comb_block_name) %>%
  group_by(DEPARTMENT_ID, PROV_ID, SLOT_BEGIN_TIME) %>%
  mutate(block_combination = paste0(unique(comb_block_name), collapse = ', ')) %>%
  group_by(DEPARTMENT_ID, PROV_ID, SLOT_BEGIN_TIME,  block_combination, new_block, release_block) %>%
  summarise(total = n()) %>%
  mutate(Slot.YearMonth = format(as.Date(SLOT_BEGIN_TIME),"%Y-%m"))
blocks_combined_type$Site <- dept_mapping$SITE[match(blocks_combined_type$DEPARTMENT_ID, dept_mapping$DEPARTMENT_ID)]
blocks_combined_type$Specialty <- dept_mapping$DEPT_SPECIALTY_NAME[match(blocks_combined_type$DEPARTMENT_ID, dept_mapping$DEPARTMENT_ID)]
blocks_combined_type$Department <- dept_mapping$DEPARTMENT_NAME[match(blocks_combined_type$DEPARTMENT_ID, dept_mapping$DEPARTMENT_ID)]
blocks_combined_type$Provider <- prov_mapping$PROV_NAME[match(blocks_combined_type$PROV_ID, prov_mapping$PROV_ID)]
# Summary of slot type by month   
new_block_conversion <- blocks_combined_type %>%
  pivot_wider(names_from = c("new_block","release_block"),
              values_from = total,
              values_fill = 0) %>%
  mutate(incorrect_new_block = ifelse(NON_NEW_BLOCK_NON_TIME_RELEASE>0 & NEW_BLOCK_NON_TIME_RELEASE>0 & NEW_BLOCK_TIME_RELEASE == 0, 1, 0),
         incorrect_time_release_block = ifelse(NON_NEW_BLOCK_NON_TIME_RELEASE>0 & NEW_BLOCK_TIME_RELEASE>0, 1, 0)) %>%
  mutate(NON_NEW_BLOCK_NON_TIME_RELEASE = ifelse(NON_NEW_BLOCK_NON_TIME_RELEASE>0 & NEW_BLOCK_NON_TIME_RELEASE==0 & NEW_BLOCK_TIME_RELEASE==0,1,0),
         NEW_BLOCK_NON_TIME_RELEASE = ifelse(NEW_BLOCK_NON_TIME_RELEASE>0 & NEW_BLOCK_TIME_RELEASE==0,1,0),
         NEW_BLOCK_TIME_RELEASE = ifelse(NEW_BLOCK_TIME_RELEASE>0,1,0)) %>%
  group_by(Site, Specialty, Department, DEPARTMENT_ID, Provider, Slot.YearMonth) %>%
  summarise(NON_NEW_BLOCK_NON_TIME_RELEASE = sum(NON_NEW_BLOCK_NON_TIME_RELEASE),
            NEW_BLOCK_NON_TIME_RELEASE = sum(NEW_BLOCK_NON_TIME_RELEASE),
            NEW_BLOCK_TIME_RELEASE = sum(NEW_BLOCK_TIME_RELEASE),
            incorrect_new_block = sum(incorrect_new_block),
            incorrect_time_release_block = sum(incorrect_time_release_block),
            TOTAL_BLOCKS = n()) %>%
  mutate(DEPARTMENT_ID = as.character(DEPARTMENT_ID)) %>%
  mutate(TOTAL_NEW_BLOCKS = NEW_BLOCK_NON_TIME_RELEASE + NEW_BLOCK_TIME_RELEASE,
         NEW_BLOCK_PERC = round(TOTAL_NEW_BLOCKS/TOTAL_BLOCKS,2),
         NEW_BLOCK_TIME_RELEASE_PERC = round(NEW_BLOCK_TIME_RELEASE/TOTAL_NEW_BLOCKS,2),
         correct_new_block = NEW_BLOCK_NON_TIME_RELEASE - incorrect_new_block,
         correct_time_release_block = NEW_BLOCK_TIME_RELEASE - incorrect_time_release_block,
         incorrect_new_block_perc = round(incorrect_new_block/NEW_BLOCK_NON_TIME_RELEASE,2),
         incorrect_time_release_perc = round(incorrect_time_release_block/NEW_BLOCK_TIME_RELEASE,2)) %>%
  arrange(Site, Department, Provider)
order <- c("Site","Department","Specialty","DEPARTMENT_ID","Provider","Slot.YearMonth",
           "TOTAL_BLOCKS","TOTAL_NEW_BLOCKS",
           "NON_NEW_BLOCK_NON_TIME_RELEASE","NEW_BLOCK_NON_TIME_RELEASE","NEW_BLOCK_TIME_RELEASE",
           "correct_new_block", "incorrect_new_block",
           "correct_time_release_block", "incorrect_time_release_block",
           "incorrect_new_block_perc", "incorrect_time_release_perc",
           "NEW_BLOCK_PERC", "NEW_BLOCK_TIME_RELEASE_PERC")
new_block_conversion <- new_block_conversion[order]
new_block_conversion$NEW_BLOCK_PERC[is.nan(new_block_conversion$NEW_BLOCK_PERC)]<-NA
new_block_conversion$NEW_BLOCK_TIME_RELEASE_PERC[is.nan(new_block_conversion$NEW_BLOCK_TIME_RELEASE_PERC)]<-NA
```


```{r Time Release of Block Duration vs. Appt Length, echo = FALSE, warning = FALSE, message = FALSE}
# # Merge data for additional slot and appt details
# block_appt_merged <- late_block_raw %>%
#   left_join(availability_raw_tbl %>% dplyr::select(DEPARTMENT_ID, PROV_ID, SLOT_BEGIN_TIME, SLOT_LENGTH,
#                                                    UNAVAILABLE_RSN_NAME, APPT_BLOCK_NAME, APPT_PRC_NAME, PAT_ENC_CSN_ID),
#             by = c("DEPARTMENT_ID", "PROV_ID", "SLOT_BEGIN_TIME")) %>%
#   left_join(access_raw_tbl %>% dplyr::select(PAT_ENC_CSN_ID, APPT_DTTM, PRC_NAME, APPT_LENGTH, VISIT_GROUP_NUM, APPT_MADE_DATE),
#             by = c("PAT_ENC_CSN_ID")) %>%
#   mutate(block_type = case_when(comb_block_name %in% new_blocks ~ "NEW_BLOCK",
#                                TRUE ~ "NON_NEW_BLOCK")) %>%
#   group_by(DEPARTMENT_ID, PROV_ID, Slot.DateYear, SLOT_BEGIN_TIME, block_type, comb_block_name, 
#            SLOT_LENGTH, UNAVAILABLE_RSN_NAME, PAT_ENC_CSN_ID, APPT_BLOCK_NAME, APPT_PRC_NAME, APPT_LENGTH, VISIT_GROUP_NUM) %>%
#   summarise(total_blocks = n()) 
#   # group_by(DEPARTMENT_ID, PROV_ID, Slot.DateYear, block_type, comb_block_name, SLOT_LENGTH, APPT_BLOCK_NAME, APPT_PRC_NAME, APPT_LENGTH, VISIT_GROUP_NUM) %>%
#   # summarise(total_blocks = n()) %>%
#   # collect()
# 
# # block_appt_merged  <- block_appt_merged  %>%
# #   mutate(incorrect = ifelse(APPT_LENGTH>=SLOT_LENGTH, APPT_LENGTH  %% SLOT_LENGTH, SLOT_LENGTH %% APPT_LENGTH))
# 
# block_appt_merged <- block_appt_merged %>%
#   collect() 
# 
# block_appt_merged$Site <- dept_mapping$SITE[match(block_appt_merged $DEPARTMENT_ID, dept_mapping$DEPARTMENT_ID)]
# block_appt_merged$Specialty <- dept_mapping$DEPT_SPECIALTY_NAME[match(block_appt_merged $DEPARTMENT_ID, dept_mapping$DEPARTMENT_ID)]
# block_appt_merged$Department <- dept_mapping$DEPARTMENT_NAME[match(block_appt_merged $DEPARTMENT_ID, dept_mapping$DEPARTMENT_ID)]
# block_appt_merged$Provider <- prov_mapping$PROV_NAME[match(block_appt_merged $PROV_ID, prov_mapping$PROV_ID)]
# 
# 
# slot_length_test <- block_appt_merged %>%
#   group_by(DEPARTMENT_ID, PROV_ID, Department, Provider, SLOT_BEGIN_TIME, SLOT_LENGTH, UNAVAILABLE_RSN_NAME) %>%
#   mutate(block_combined = paste(unique(comb_block_name), collapse = ", ")) %>%
#   group_by(DEPARTMENT_ID, PROV_ID, Department, Provider, SLOT_BEGIN_TIME, SLOT_LENGTH, UNAVAILABLE_RSN_NAME, block_combined) %>%
#   summarise(total = n()) %>%
#   dplyr::select(-total)
# 
# appt_length_test <- block_appt_merged %>%
#   collect() %>%
#   group_by(DEPARTMENT_ID, PROV_ID, Department, Provider, SLOT_BEGIN_TIME, PAT_ENC_CSN_ID, APPT_BLOCK_NAME, APPT_PRC_NAME, VISIT_GROUP_NUM, APPT_LENGTH) %>%
#   summarise(total = n()) %>%
#   group_by(DEPARTMENT_ID, PROV_ID, Department, Provider, SLOT_BEGIN_TIME) %>%
#   mutate(total = n()) %>%
#   filter(!(is.na(PAT_ENC_CSN_ID) & total >1)) %>%
#   dplyr::select(-total)
# 
# merge_test <- merge(slot_length_test, appt_length_test)
# 
# # Analyze Booked Rate based on Slot Length -------------------------------------
# unbooked_slots <- merge_test %>%
#   filter(is.na(UNAVAILABLE_RSN_NAME)) %>%
#   filter(is.na(PAT_ENC_CSN_ID)) %>%
#   mutate(Slot.DateYear = as.Date(SLOT_BEGIN_TIME, "%Y-%m-%d")) %>%
#   group_by(DEPARTMENT_ID, Department, PROV_ID, Provider, Slot.DateYear, SLOT_LENGTH) %>%
#   summarise(total = n()) %>%
#   pivot_wider(names_from = SLOT_LENGTH,
#               values_from = total,
#               values_fill = 0)
```


```{r Sinai Logo, echo=FALSE, out.width = '15%'}
knitr::include_graphics("Mount_Sinai_Logo_H.png")
```


# Late-Releasing New Patient Blocks for New Patient Visits {.tabset .tabset-fade .tabset-pills}
*Report run date: `r report_run_date`*<br/>
______________________________________________________________________________________________________________________________
<br/>
<br/>


## Late-Releasing New Patient Block Conversion
```{r Block Conversion Output (block Count), echo = FALSE, warning = FALSE, message = FALSE}
# Table Output -----------------------------------------------------------------
htmltools::browsable(
  tagList(
    tags$button(
      tagList(fontawesome::fa("download"), "Download Table"),
      onclick = "Reactable.downloadDataCSV('block-conversion', 'Block Conversion')"
    ),
# htmltools::browsable(
#   tagList(
#     div(tags$label("Group by", `for` = "cars-grouping-select")),
#     tags$select(
#       id = "cars-grouping-select",
#       onchange = "Reactable.setGroupBy('cars-grouping-table', this.value ? [this.value] : [])",
#       tags$option("None", value = c("Campus","Campus.Specialty.Group")),
#       # tags$option("Test", value = c("Appt.Source.New","Campus.Specialty.Group")),
#       # lapply(c("Campus", "Campus.Specialty.Group", "Appt.Source.New"), tags$option)
#       lapply(c("Campus", "Campus.Specialty.Group", "Appt.Source.New"), tags$option)
#     ),
#
#     tags$hr("aria-hidden" = "true"),
reactable(
  new_block_conversion %>%
    mutate(Slot.YearMonth = as.character(Slot.YearMonth)),
  elementId = "block-conversion",
  # elementId = "cars-grouping-table",
  style = list(fontFamily = 'Calibri',
                 fontSize = '14px'),
    defaultColDef = colDef(align = "left",
                           headerStyle = list(fontWeight = "Bold", fontSize = "14px"),
                           headerClass = "bar-sort-header"),
  # RowStyle = function(index) {
  #           if (index %in% c(nrow(referral_vol_site_data_mshs))) {
  #             list(`border-top` = "2px solid rgb(184,184,184)",
  #                  fontWeight = "Bold")
  #           }
  #         },
    highlight = TRUE,
    # filterable = TRUE,
    pagination = FALSE,
    # height = 800,
    wrap = TRUE,
  searchable = TRUE,
  rowStyle = function(index) {
            if (index %in% c(10)) {
              list(`border-top` = "2px solid rgb(184,184,184)",
                   fontWeight = "Bold")
            }
          },
  groupBy = c("Site", "Department", "Specialty", "Provider", "Slot.YearMonth"),
  columns = list(
    Site = colDef(
      name = "Site",
      minWidth = 180),
    
    Specialty = colDef(
      minWidth = 200),
    
    Department = colDef(
      minWidth = 200),
    Provider = colDef(
      minWidth = 130),
    Slot.YearMonth = colDef(
      name = "Year-Month",
      minWidth = 100),
    TOTAL_BLOCKS = colDef(
      name = "Total Blocks",
      maxWidth = 100,
      headerStyle = list(background = "#212070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = 'sum',
      format = colFormat(separators = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    TOTAL_NEW_BLOCKS = colDef(
      name = "Total New Patient Blocks",
      maxWidth = 100,
      headerStyle = list(background = "#212070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = 'sum',
      format = colFormat(separators = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    
    correct_new_block = colDef(
      name = "Individual Non-Late-Releasing Blocks",
      maxWidth = 100,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = 'sum',
      format = colFormat(separators = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    incorrect_new_block = colDef(
      name = "Combination Non-Late-Releasing Blocks",
      maxWidth = 100,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = 'sum',
      format = colFormat(separators = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    correct_time_release_block = colDef(
      name = "Individual Late-Releasing Blocks",
      maxWidth = 100,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = 'sum',
      format = colFormat(separators = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    incorrect_time_release_block = colDef(
      name = "Combination Late-Releasing Blocks",
      maxWidth = 100,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = 'sum',
      format = colFormat(separators = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    NEW_BLOCK_PERC = colDef(
      name = "% of New Patient Blocks",
      maxWidth = 150,
     headerStyle = list(background = "#a5a7a5", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalTOTAL_BLOCKS = 0
        let totalTOTAL_NEW_BLOCKS = 0
        rows.forEach(function(row) {
          totalTOTAL_BLOCKS += row['TOTAL_BLOCKS']
          totalTOTAL_NEW_BLOCKS += row['TOTAL_NEW_BLOCKS']
        })
        return (totalTOTAL_NEW_BLOCKS) / totalTOTAL_BLOCKS || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    NEW_BLOCK_TIME_RELEASE_PERC = colDef(
      name = "% of New Patient Blocks Converted to Late-Releasing Blocks",
      maxWidth = 150,
     headerStyle = list(background = "#a5a7a5", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalTOTAL_NEW_BLOCKS = 0
        let totalNEW_BLOCK_TIME_RELEASE = 0
        rows.forEach(function(row) {
          totalTOTAL_NEW_BLOCKS += row['TOTAL_NEW_BLOCKS']
          totalNEW_BLOCK_TIME_RELEASE += row['NEW_BLOCK_TIME_RELEASE']
        })
        return (totalNEW_BLOCK_TIME_RELEASE) / totalTOTAL_NEW_BLOCKS || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    # Specialty = colDef(show =F),
    DEPARTMENT_ID = colDef(show =F),
    NON_NEW_BLOCK_NON_TIME_RELEASE = colDef(show =F),
    NEW_BLOCK_TIME_RELEASE = colDef(show =F),
    NEW_BLOCK_NON_TIME_RELEASE = colDef(show =F),
    incorrect_new_block = colDef(show =F),
    incorrect_late_release_block = colDef(show =F),
    incorrect_new_block_perc = colDef(show =F),
    incorrect_time_release_perc = colDef(show =F)
  ) # Close Columns
  ) # Close Reactable
 )
)
```
<br/>
<br/>


## Late-Releasing New Patient Block Openings
```{r Block Build and Openings Output, echo = FALSE, warning = FALSE, message = FALSE}
# Table Output -----------------------------------------------------------------
htmltools::browsable(
  tagList(
    tags$button(
      tagList(fontawesome::fa("download"), "Download Table"),
      onclick = "Reactable.downloadDataCSV('block-build-openings', 'Block Build and Openings')"
    ),
# htmltools::browsable(
#   tagList(
#     div(tags$label("Group by", `for` = "cars-grouping-select")),
#     tags$select(
#       id = "cars-grouping-select",
#       onchange = "Reactable.setGroupBy('cars-grouping-table', this.value ? [this.value] : [])",
#       tags$option("None", value = c("Campus","Campus.Specialty.Group")),
#       # tags$option("Test", value = c("Appt.Source.New","Campus.Specialty.Group")),
#       # lapply(c("Campus", "Campus.Specialty.Group", "Appt.Source.New"), tags$option)
#       lapply(c("Campus", "Campus.Specialty.Group", "Appt.Source.New"), tags$option)
#     ),
#
#     tags$hr("aria-hidden" = "true"),
reactable(
  block_openings %>%
    mutate(Slot.YearMonth = as.character(Slot.YearMonth),
           SLOT_BEGIN_TIME = as.character(SLOT_BEGIN_TIME)),
  elementId = "block-build-openings",
  # elementId = "cars-grouping-table",
  style = list(fontFamily = 'Calibri',
                 fontSize = '14px'),
    defaultColDef = colDef(align = "left",
                           headerStyle = list(fontWeight = "Bold", fontSize = "14px"),
                           headerClass = "bar-sort-header"),
  # RowStyle = function(index) {
  #           if (index %in% c(nrow(referral_vol_site_data_mshs))) {
  #             list(`border-top` = "2px solid rgb(184,184,184)",
  #                  fontWeight = "Bold")
  #           }
  #         },
    highlight = TRUE,
    # filterable = TRUE,
    pagination = FALSE,
    # height = 800,
    wrap = TRUE,
  searchable = TRUE,
  rowStyle = function(index) {
            if (index %in% c(10)) {
              list(`border-top` = "2px solid rgb(184,184,184)",
                   fontWeight = "Bold")
            }
          },
  groupBy = c("Site", "Slot.YearMonth", "Department", "Provider"),
  columns = list(
    Site = colDef(
      name = "Site",
      minWidth = 160),
    
    # Specialty = colDef(
    #   minWidth = 200),
    
    Department = colDef(
      minWidth = 200),
    
    Provider = colDef(
      minWidth = 150),
    
    Slot.YearMonth = colDef(
      name = "Year-Month",
      minWidth = 100),
    
    incorrect_slot = colDef(
      name = "Incorrectly Build Slots",
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = 'sum',
      format = colFormat(separators = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)"),
      minWidth = 90),
    
    # incorrect_perc = colDef(
    #   name = "% of Incorrectly Builid Slots",
    #   maxWidth = 150,
    #  headerStyle = list(background = "#a5a7a5", color = "white", fontWeight = "Bold", fontSize = "14px"),
    #   aggregate = JS("function(values, rows) {
    #     let totaltotal_slot = 0
    #     let totalincorrect_slot = 0
    #     rows.forEach(function(row) {
    #       totaltotal_slot += row['total_slot']
    #       totalincorrect_slot += row['incorrect_slot']
    #     })
    #     return (totalincorrect_slot) / totaltotal_slot || '-'
    #   }"),
    #   format = colFormat(percent = TRUE, digits = 0),
    #   style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    # ),
    
    SLOT_BEGIN_TIME = colDef(
      name = "Slot Time",
      minWidth = 130),
    
    ORG_REG_OPENINGS = colDef(
      name = "Total Openings",
      headerStyle = list(background = "#212070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)"),
      minWidth = 90),
    
    block_combination = colDef(
      name = "Blocks Assigned",
      headerStyle = list(background = "#212070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)"),
      minWidth = 150),
    
    `openings_non-new` = colDef(
      name = "Non-New Block Openings",
      headerStyle = list(background = "#212070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)"),
      minWidth = 90),
    
    openings_new = colDef(
      name = "New Block Openings",
      headerStyle = list(background = "#212070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)"),
      minWidth = 90),
    
    openings_release = colDef(
      name = "Late-Releasing Block Openings",
      headerStyle = list(background = "#212070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)"),
      minWidth = 90),
    
    incorrect_slot_reason = colDef(
      name = "Incorrect Block Build Reason",
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)"),
      minWidth = 150),

    `blocks_non-new` = colDef(show =F),
    blocks_release = colDef(show =F),
    blocks_new = colDef(show =F),
    total_slot = colDef(show =F),
    incorrect_perc = colDef(show =F),
    DEPARTMENT_ID = colDef(show =F),
    PROV_ID = colDef(show =F),
    Specialty = colDef(show =F),
    Slot.DateYear = colDef(show =F)
    
  ) # Close Columns
  ) # Close Reactable
 )
)
```
<br/>
<br/>



<!-- ## Late-Releasing New Patient Block Build -->
<!-- ```{r Block Combination Output (Slot Count), echo = FALSE, warning = FALSE, message = FALSE} -->
<!-- # Table Output ----------------------------------------------------------------- -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       tagList(fontawesome::fa("download"), "Download Table"), -->
<!--       onclick = "Reactable.downloadDataCSV('block-type-count', 'Block Type Usage')" -->
<!--     ), -->
<!-- # htmltools::browsable( -->
<!-- #   tagList( -->
<!-- #     div(tags$label("Group by", `for` = "cars-grouping-select")), -->
<!-- #     tags$select( -->
<!-- #       id = "cars-grouping-select", -->
<!-- #       onchange = "Reactable.setGroupBy('cars-grouping-table', this.value ? [this.value] : [])", -->
<!-- #       tags$option("None", value = c("Campus","Campus.Specialty.Group")), -->
<!-- #       # tags$option("Test", value = c("Appt.Source.New","Campus.Specialty.Group")), -->
<!-- #       # lapply(c("Campus", "Campus.Specialty.Group", "Appt.Source.New"), tags$option) -->
<!-- #       lapply(c("Campus", "Campus.Specialty.Group", "Appt.Source.New"), tags$option) -->
<!-- #     ), -->
<!-- #  -->
<!-- #     tags$hr("aria-hidden" = "true"), -->
<!-- reactable( -->
<!--   block_combination_usage %>% -->
<!--     ungroup() %>% -->
<!--     dplyr::select(-c(total_blocks,DEPARTMENT_ID, PROV_ID)) %>% -->
<!--     mutate(Slot.DateYear = as.character(Slot.DateYear)), -->
<!--   elementId = "block-type-count", -->
<!--   # elementId = "cars-grouping-table", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_data_mshs))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   rowStyle = function(index) { -->
<!--             if (index %in% c(10)) { -->
<!--               list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--                    fontWeight = "Bold") -->
<!--             } -->
<!--           }, -->
<!--   groupBy = c("Site", "Department","Provider"), -->
<!--   # columnGroups = list( -->
<!--   #   # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " Visit Volume"),  -->
<!--   #   #          columns = c("Total", "new_perc"), -->
<!--   #   #          headerStyle = list(color = "#212070", fontSize = "16px")), -->
<!--   #   # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " No Show Rate"),  -->
<!--   #   #          columns = c("noShow_rate", "noShow_rate_Established", "noShow_rate_New"), -->
<!--   #   #          headerStyle = list(color = "#d80b8c", fontSize = "16px")) -->
<!--   #   colGroup(name = "",  -->
<!--   #            columns = c("Campus","Campus.Specialty.Group"), sticky = "left",  -->
<!--   #            headerStyle = list(fontSize = "16px")), -->
<!--   #   colGroup(name = paste0(current_year, " YTD Visit Volume"),  -->
<!--   #            columns = c("Arrived","arrived_perc","new_perc"), -->
<!--   #            headerStyle = list(color = "#212070", fontSize = "16px")), -->
<!--   #   colGroup(name = "No Show Plus Rate - All",  -->
<!--   #            columns = c("noShow_rate", "noShow_rate_sameDay", "noShow_rate_belowFourteen", "noShow_rate_belowThirty", "noShow_rate_overThirty"), -->
<!--   #            headerStyle = list(color = "#7f7f7f", fontSize = "16px")), -->
<!--   #   colGroup(name = "No Show Plus Rate - Established",  -->
<!--   #            columns = c("noShow_rate_Established", "noShow_rate_sameDay_Established", "noShow_rate_belowFourteen_Established", "noShow_rate_belowThirty_Established", "noShow_rate_overThirty_Established"), -->
<!--   #            headerStyle = list(color = "#d80b8c", fontSize = "16px")), -->
<!--   #   colGroup(name = "No Show Plus Rate - New",  -->
<!--   #            columns = c("noShow_rate_New","noShow_rate_sameDay_New", "noShow_rate_belowFourteen_New","noShow_rate_belowThirty_New", "noShow_rate_overThirty_New"), -->
<!--   #            headerStyle = list(color = "#00aeef", fontSize = "16px")) -->
<!--   #   ), -->
<!--   columns = list( -->
<!--     Site = colDef( -->
<!--       minWidth = 180), -->

<!--     Department = colDef( -->
<!--       minWidth = 200), -->

<!--     Provider = colDef( -->
<!--       minWidth = 130), -->

<!--     Slot.DateYear = colDef( -->
<!--       name = "Date", -->
<!--       minWidth = 100), -->

<!--     # Slot.Year = colDef( -->
<!--     #   name = "Year", -->
<!--     #   minWidth = 100), -->
<!--     #  -->
<!--     # Slot.Month = colDef( -->
<!--     #   name = "Month", -->
<!--     #   minWidth = 100), -->

<!--     # Slot.DateYear = colDef( -->
<!--     #   name = "Date", -->
<!--     #   minWidth = 100), -->

<!--     block_combination = colDef( -->
<!--       name = "Block Combination", -->
<!--       minWidth = 200), -->

<!--     total_slots = colDef( -->
<!--       name = "Total Slots", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = 'sum', -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     slot_incorrect = colDef( -->
<!--       name = "Slot Incorrectly Built (Y/N)", -->
<!--       minWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px")), -->

<!--     DEPARTMENT_ID = colDef(show=F) -->
<!--   ) # Close Columns -->
<!--   ) # Close Reactable -->
<!--  ) -->
<!-- ) -->
<!-- ``` -->
